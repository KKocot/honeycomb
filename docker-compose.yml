services:
  docs:
    build:
      context: .
      dockerfile: Dockerfile.docs
    image: honeycomb-docs:latest
    container_name: honeycomb-docs
    restart: always
    tty: true
    stdin_open: true
    networks:
      - common_proxy_network
    expose:
      - "3030"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:3030/"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=common_proxy_network"
      # HTTP router (for Cloudflare proxy)
      - "traefik.http.routers.honeycomb-docs.rule=Host(`${DOMAIN}`) && PathPrefix(`/docs`)"
      - "traefik.http.routers.honeycomb-docs.entrypoints=web"
      - "traefik.http.routers.honeycomb-docs.service=honeycomb-docs"
      # HTTPS router
      - "traefik.http.routers.honeycomb-docs-secure.rule=Host(`${DOMAIN}`) && PathPrefix(`/docs`)"
      - "traefik.http.routers.honeycomb-docs-secure.tls=true"
      - "traefik.http.routers.honeycomb-docs-secure.entrypoints=websecure"
      - "traefik.http.routers.honeycomb-docs-secure.service=honeycomb-docs"
      - "traefik.http.services.honeycomb-docs.loadbalancer.server.port=3030"

  demo:
    build:
      context: .
      dockerfile: Dockerfile.demo
    image: honeycomb-demo:latest
    container_name: honeycomb-demo
    restart: always
    tty: true
    stdin_open: true
    environment:
      - NODE_ENV=production
    networks:
      - common_proxy_network
    expose:
      - "3031"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:3031/"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=common_proxy_network"
      # HTTP router (for Cloudflare proxy)
      - "traefik.http.routers.honeycomb-demo.rule=Host(`${DOMAIN}`) && PathPrefix(`/demo`)"
      - "traefik.http.routers.honeycomb-demo.entrypoints=web"
      - "traefik.http.routers.honeycomb-demo.service=honeycomb-demo"
      # HTTPS router
      - "traefik.http.routers.honeycomb-demo-secure.rule=Host(`${DOMAIN}`) && PathPrefix(`/demo`)"
      - "traefik.http.routers.honeycomb-demo-secure.tls=true"
      - "traefik.http.routers.honeycomb-demo-secure.entrypoints=websecure"
      - "traefik.http.routers.honeycomb-demo-secure.service=honeycomb-demo"
      - "traefik.http.services.honeycomb-demo.loadbalancer.server.port=3031"

networks:
  common_proxy_network:
    external: true
